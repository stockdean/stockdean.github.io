<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CMAKE 学习 | MyBlog</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CMAKE 学习</h1><a id="logo" href="/.">MyBlog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">CMAKE 学习</h1><div class="post-meta"><a href="/2019/04/10/CMAKE 学习/#comments" class="comment-count"></a><p><span class="date">Apr 10, 2019</span><span><a href="/categories/linux/" class="category">Linux</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><hr>
<h2 id="CMAKE-学习"><a href="#CMAKE-学习" class="headerlink" title="CMAKE 学习"></a>CMAKE 学习</h2><h2 id="1-初始cmake"><a href="#1-初始cmake" class="headerlink" title="1. 初始cmake"></a>1. 初始cmake</h2><h3 id="1-1-特点"><a href="#1-1-特点" class="headerlink" title="1.1 特点"></a>1.1 特点</h3><ul>
<li>开源</li>
<li>跨平台</li>
<li>管理大型项目</li>
<li>简化编译</li>
<li>高效</li>
<li>可扩展<h3 id="1-2-问题"><a href="#1-2-问题" class="headerlink" title="1.2 问题"></a>1.2 问题</h3>需要编写<code>CMakeLists.txt</code>,与pkgconfig配合不好。<h3 id="1-3-适用"><a href="#1-3-适用" class="headerlink" title="1.3 适用"></a>1.3 适用</h3>适用C/C++的大型工程，qt不需要。<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h2><a href="http://www.cmake.org/HTML/Download.html" target="_blank" rel="noopener">官网下载</a><br>包管理工具下载</li>
</ul>
<h2 id="3-初试cmake"><a href="#3-初试cmake" class="headerlink" title="3. 初试cmake"></a>3. 初试cmake</h2><h3 id="3-1-写一个简单的main-c和CMakeLists-txt"><a href="#3-1-写一个简单的main-c和CMakeLists-txt" class="headerlink" title="3.1 写一个简单的main.c和CMakeLists.txt"></a>3.1 写一个简单的main.c和CMakeLists.txt</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="meta">#include <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">printf(“Hello World from t1 Main!\n”);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROJECT</span> (HELLO)</span><br><span class="line"><span class="keyword">SET</span>(SRC_LIST main.c)</span><br><span class="line"><span class="keyword">MESSAGE</span>(STATUS <span class="string">"This is BINARY dir "</span> <span class="variable">$&#123;HELLO_BINARY_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">MESSAGE</span>(STATUS <span class="string">"This is SOURCE dir "</span><span class="variable">$&#123;HELLO_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(hello <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-开始构建"><a href="#3-2-开始构建" class="headerlink" title="3.2 开始构建"></a>3.2 开始构建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake . <span class="comment">#生成Makefile等文件</span></span><br><span class="line">make <span class="comment">#开始make</span></span><br><span class="line">./hello <span class="comment">#执行应用</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-简单解释"><a href="#3-3-简单解释" class="headerlink" title="3.3 简单解释"></a>3.3 简单解释</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROJECT</span>(projectname [CXX] [C] [Java])</span><br><span class="line"><span class="comment"># 可以指定工程的名称和语言。这个指令隐含定义了&lt;projectname&gt;_BINARY_DIR和&lt;projectname&gt;_SOURCE_DIR。</span></span><br><span class="line"><span class="comment"># 由于是内部编译，上面的变量代表了工程所在的目录，如果是外部编译会不同。</span></span><br><span class="line"><span class="comment"># 建议使用cmake预定义的PROJECT_BINARY_DIR和PROJECT_SOURCE_DIR否则修改工程名称会修改前面的变量。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span>(VAR [VALUE] [CACHE TYPE DOCSTRING [FORCE]])</span><br><span class="line"><span class="comment"># SET命令显示定义变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MESSAGE</span>([SEND_ERROR | STATUS | FATAL_ERROR] <span class="string">"message to display"</span></span><br><span class="line">...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个指令向terminal输出用户定义的信息，包含三种类型：</span></span><br><span class="line"><span class="comment"># SEND_ERROR, 产生错误，生成过程被跳过。</span></span><br><span class="line"><span class="comment"># STATUS, 输出前缀为-的信息</span></span><br><span class="line"><span class="comment"># FATAL_ERROR，立即终止所有cmake 过程。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(hello <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"><span class="comment"># 定义了这个工程会生成一个文件名为hello的可执行文件。</span></span><br><span class="line"><span class="comment"># 使用$&#123;&#125;来应用变量，但是在IF语句中，不需要$&#123;&#125;。</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-基本语法"><a href="#3-4-基本语法" class="headerlink" title="3.4 基本语法"></a>3.4 基本语法</h3><ol>
<li>变量使用${}取值，if中直接变量名</li>
<li>command(arg1 arg2 …)</li>
<li>指令大小写无关，参数和变量<strong>大小写相关</strong>。但是推荐全大写指令。<h3 id="3-5-关于语法的疑惑"><a href="#3-5-关于语法的疑惑" class="headerlink" title="3.5 关于语法的疑惑"></a>3.5 关于语法的疑惑</h3>如果文件名中间没有空格，可以不加引号。但是如果有空格，需要加引号。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 例如</span><br><span class="line">SET(SRC_LIST &quot;fu nc.c&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>另外可以忽略source列表的源文件后缀，但是不建议这么做。<br>参数也可以使用;隔开。</p>
<h3 id="3-6-清理工程"><a href="#3-6-清理工程" class="headerlink" title="3.6 清理工程"></a>3.6 清理工程</h3><p><code>make clean</code> 即可对结果进行清理</p>
<h3 id="3-7-其他问题"><a href="#3-7-其他问题" class="headerlink" title="3.7 其他问题"></a>3.7 其他问题</h3><ul>
<li>cmake 不支持make distclean </li>
<li>cmake强烈建议外部构建(out-of-source build)<h3 id="3-8-内部构建与外部构建"><a href="#3-8-内部构建与外部构建" class="headerlink" title="3.8 内部构建与外部构建"></a>3.8 内部构建与外部构建</h3>外部编译举例（编译wxGTX动态库和静态库）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压wxGTX</span></span><br><span class="line">mkdir static shared</span><br><span class="line"><span class="built_in">cd</span> static</span><br><span class="line">../configure --<span class="built_in">enable</span>-static <span class="comment"># 在static 生成静态库</span></span><br><span class="line"><span class="built_in">cd</span> ../shared</span><br><span class="line">../configure --<span class="built_in">enable</span>-shared <span class="comment"># 在shared生成动态库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改以前的编译方式</span></span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注意编译后的HELLO_BINARY_DIR指代的路径改变为&lt;src目录&gt;/build</p>
</blockquote>
<h3 id="3-9-小结"><a href="#3-9-小结" class="headerlink" title="3.9 小结"></a>3.9 小结</h3><p>这一节讲了3个显示命令的用法和变量。后面开始构架工程。</p>
<h2 id="4-一个更好的helloworld"><a href="#4-一个更好的helloworld" class="headerlink" title="4. 一个更好的helloworld"></a>4. 一个更好的helloworld</h2><p>本章任务：</p>
<ol>
<li>为工程添加src子目录，用来放置工程源代码</li>
<li>添加一个doc，放置工程文档hello.txt</li>
<li>在工程目录添加文本文件COPYWRITE,README</li>
<li>在工程目录添加一个runhello.sh,用来调试hello二进制</li>
<li>将构建后的目标文件放入构建目录的bin子目录</li>
<li>最终安装这些文件：将hello二进制和runhello.sh安装至/usr/bin,将doc目录的内容以及COPYWRITE/README安装到<code>&lt;工程目录&gt;/doc/cmake/t2</code></li>
</ol>
<h3 id="4-1-准备工作"><a href="#4-1-准备工作" class="headerlink" title="4.1 准备工作"></a>4.1 准备工作</h3><ol>
<li>创建t2并把源码和CMakeLists.txt拷贝到目录下</li>
<li>创建src，并把源码cut到目录下，添加CMakeLists.txt</li>
<li>修改工程的CMakeLists.txt</li>
<li>建立build目录并外部编译。<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(hello main.c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># t1/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">PROJECT</span>(HELLO)</span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(src bin)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-2-语法解释"><a href="#4-2-语法解释" class="headerlink" title="4.2 语法解释"></a>4.2 语法解释</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(source_dir [binary_dir][EXCLUDE_FROM_ALL])</span><br><span class="line"><span class="comment"># 如果不指定目录，那么bin文件会放在build/src目录下。</span></span><br><span class="line"><span class="keyword">SUBDIRS</span>(dir1 dir2 ...)</span><br><span class="line"><span class="comment"># 这个目录不推荐使用，可以一次添加多个子目录，并且即使外部编译子目录体系仍保存。</span></span><br><span class="line"><span class="comment"># 如果把第一条改成第二条命令，那么bin文件会放在build/src目录下。</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-另存为bin文件"><a href="#4-3-另存为bin文件" class="headerlink" title="4.3 另存为bin文件"></a>4.3 另存为bin文件</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;PROJECT_BINARY_DIR&#125;</span>/bin)</span><br><span class="line"><span class="comment"># 设置exe文件输出路径</span></span><br><span class="line"><span class="keyword">SET</span>(LIBRARY_OUTPUT_PATH <span class="variable">$&#123;PROJECT_BINARY_DIR&#125;</span>/lib)</span><br><span class="line"><span class="comment"># 设置库文件输出路径</span></span><br><span class="line"><span class="comment"># 这个文件应该放在ADD_EXECUTABLE和ADD_LIBRARY路径。</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-如何安装"><a href="#4-4-如何安装" class="headerlink" title="4.4 如何安装"></a>4.4 如何安装</h3><ol>
<li>编译后make install安装</li>
<li>打包时的指定目录安装<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例如一个简单的Makefile</span></span><br><span class="line">DESTDIR=</span><br><span class="line"><span class="section">install:</span></span><br><span class="line">	mkdir -p <span class="variable">$(DESTDIR)</span>/usr/bin</span><br><span class="line">	install -m 755 hello <span class="variable">$(DESTDIR)</span>/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过make install 安装到/usr/bin</span></span><br><span class="line"><span class="comment"># 或者make install DESTDIR=/tmp/test 将他安装在 /tmp/test/usr/bin 目录，打包时这个方式经常被使用。</span></span><br><span class="line"><span class="comment"># 或者定义PREFIX使用autotools</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr 或者./configure --prefix=/usr/local</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>对于我们的Helloworld工程，可以引入一个新的cmake指令<code>INSTALL</code>和一个变量<code>CMAKE_INSTALL_PREFIX</code><br>CMAKE_INSTALL_PREFIX类似configure命令的–prefix。<br>常用方法如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr</span><br></pre></td></tr></table></figure></p>
<p>INSTALL指令用于定义安装规则，安装内容包括目标二进制、动态库以及文件、目录和脚本<br>INSTALL指令包含了各种安装类型。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目标文件的安装：</span></span><br><span class="line"><span class="keyword">INSTALL</span>(TARGETS targets...</span><br><span class="line">	 [[ARCHIVE|LIBRARY|RUNTIME]</span><br><span class="line">		 [DESTINATION &lt;dir&gt;]</span><br><span class="line">		 [PERMISSIONS permissions...]</span><br><span class="line">		 [CONFIGURATIONS</span><br><span class="line">	 [Debug|Release|...]]</span><br><span class="line">		 [COMPONENT &lt;component&gt;]</span><br><span class="line">		 [OPTIONAL]</span><br><span class="line">		 ] [...])</span><br><span class="line"><span class="comment"># 参数中的 TARGETS 后面跟的就是我们通过 ADD_EXECUTABLE 或者 ADD_LIBRARY 定义的目标文件，可能是可执行二进制、动态库、静态库。</span></span><br><span class="line"><span class="comment"># 目标类型也就相对应的有三种，ARCHIVE 特指静态库，LIBRARY 特指动态库，RUNTIME特指可执行目标二进制。</span></span><br><span class="line"><span class="comment"># DESTINATION 定义了安装的路径，如果路径以/开头，那么指的是绝对路径，这时候CMAKE_INSTALL_PREFIX 其实就无效了。如果你希望使用 CMAKE_INSTALL_PREFIX 来定义安装路径，就要写成相对路径，即不要以/开头，那么安装后的路径就是$&#123;CMAKE_INSTALL_PREFIX&#125;/&lt;DESTINATION 定义的路径&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通文件的安装</span></span><br><span class="line"><span class="keyword">INSTALL</span>(FILES files... DESTINATION &lt;dir&gt;</span><br><span class="line">	 [PERMISSIONS permissions...]</span><br><span class="line">	 [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">	 [COMPONENT &lt;component&gt;]</span><br><span class="line">	 [RENAME &lt;name&gt;] [OPTIONAL])</span><br><span class="line"><span class="comment"># 安装一般文件，并可以指定访问权限，文件名是此指令所在路径下的相对路径。如果默认不定义权限 PERMISSIONS，安装后的权限为：644</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 非目标文件的可执行程序安装(比如脚本之类)：</span></span><br><span class="line"><span class="keyword">INSTALL</span>(PROGRAMS files... DESTINATION &lt;dir&gt;</span><br><span class="line">	 [PERMISSIONS permissions...]</span><br><span class="line">	 [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">	 [COMPONENT &lt;component&gt;]</span><br><span class="line">	 [RENAME &lt;name&gt;] [OPTIONAL])</span><br><span class="line"><span class="comment"># 跟上面的 FILES 指令使用方法一样，唯一的不同是安装后权限为:755</span></span><br><span class="line"><span class="comment"># 目录的安装：</span></span><br><span class="line"><span class="keyword">INSTALL</span>(DIRECTORY dirs... DESTINATION &lt;dir&gt;</span><br><span class="line">	 [FILE_PERMISSIONS permissions...]</span><br><span class="line">	 [DIRECTORY_PERMISSIONS permissions...]</span><br><span class="line">	 [USE_SOURCE_PERMISSIONS]</span><br><span class="line">	 [CONFIGURATIONS [Debug|Release|...]]</span><br><span class="line">	 [COMPONENT &lt;component&gt;]</span><br><span class="line">	 [[PATTERN &lt;pattern&gt; | REGEX &lt;regex&gt;]</span><br><span class="line">	 [EXCLUDE] [PERMISSIONS permissions...]] [...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># DIRECTORY 后面连接的是所在 Source 目录的相对路径，但务必注意：abc 和 abc/有很大的区别。</span></span><br><span class="line"><span class="comment"># 如果目录名不以/结尾，那么这个目录将被安装为目标路径下的 abc，如果目录名以/结尾，代表将这个目录中的内容安装到目标路径，但不包括这个目录本身。</span></span><br><span class="line"><span class="comment"># PATTERN 用于使用正则表达式进行过滤，PERMISSIONS 用于指定 PATTERN 过滤后的文件权限。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装时CMAKE 脚本的执行：</span></span><br><span class="line"><span class="keyword">INSTALL</span>([[SCRIPT &lt;file&gt;] [CODE &lt;code&gt;]] [...])</span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                  </span><br><span class="line"><span class="comment"># SCRIPT 用于安装时调用cmake脚本文件(&lt;abc&gt;.cmake文件)</span></span><br><span class="line"><span class="comment"># CODE 用于执行CMAKE指令，必须以""括起来</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-5-修改Project并支持安装。"><a href="#4-5-修改Project并支持安装。" class="headerlink" title="4.5 修改Project并支持安装。"></a>4.5 修改Project并支持安装。</h3><ol>
<li>根目录下，添加doc，在doc下建立一个hello.txt</li>
<li>根目录下添加runhello.sh脚本，COPYWRITE和README</li>
<li>改写根目录的CMakeLists.txt</li>
<li>在build目录使用<code>cmake -DCMAKE_INSTALL_PREFIX=&lt;想安装的路径&gt; ..</code> 进行外部编译</li>
<li><code>make &amp;&amp; make install</code></li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /CMakeLists.txt</span></span><br><span class="line"><span class="keyword">PROJECT</span> (HELLO)</span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(src bin)</span><br><span class="line"><span class="keyword">INSTALL</span>(FILES COPYRIGHT README DESTINATION share/doc/cmake/t2)</span><br><span class="line"><span class="keyword">INSTALL</span>(PROGRAMS build/bin/hello runhello.sh DESTINATION bin)</span><br><span class="line"><span class="keyword">INSTALL</span>(DIRECTORY doc/ DESTINATION share/doc/cmake/t2)</span><br></pre></td></tr></table></figure>
<h3 id="4-6-小结"><a href="#4-6-小结" class="headerlink" title="4.6 小结"></a>4.6 小结</h3><p>如果没有定义<code>CMAKE_INSTALL_PREFIX</code>,那么会默认安装到<code>/usr/local</code></p>
<h2 id="5-静态库和动态库的构建"><a href="#5-静态库和动态库的构建" class="headerlink" title="5. 静态库和动态库的构建"></a>5. 静态库和动态库的构建</h2><p>本章任务：</p>
<ol>
<li>建立一个静态库和动态库，提供HelloFunc函数供其他程序编程使用，HelloFunc向终端输出HelloWorld字符串</li>
<li>安装头文件与共享库</li>
</ol>
<h3 id="5-1-建立并搭建一个动态库"><a href="#5-1-建立并搭建一个动态库" class="headerlink" title="5.1 建立并搭建一个动态库"></a>5.1 建立并搭建一个动态库</h3><ol>
<li>在工程目录下建立t3目录</li>
<li>在t3下创建CMakeLists.txt</li>
<li>在t3下创建lib目录，并创建<code>hello.c,hello.h,lib/CMakeLists.txt</code></li>
<li>根目录下建立build目录并编译。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># /CMakeLists.txt</span><br><span class="line">PROJECT(HELLOLIB)</span><br><span class="line">ADD_SUBDIRECTORY(lib)</span><br><span class="line"></span><br><span class="line"># lib/CMakeLists.txt</span><br><span class="line">SET(LIBHELLO_SRC hello.c)</span><br><span class="line">ADD_LIBRARY(hello SHARED $&#123;LIBHELLO_SRC&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-2-语法解释"><a href="#5-2-语法解释" class="headerlink" title="5.2 语法解释"></a>5.2 语法解释</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD_LIBRARY</span>(libname [SHARED|STATIC|MODULE]</span><br><span class="line">		[EXCLUDE_FROM_ALL]</span><br><span class="line">				source1 source2  ... sourceN)</span><br></pre></td></tr></table></figure>
<p>库类型有三种：<br>SHARED，动态库<br>STATIC，静态库<br>MODULE，在使用dyld的OS有效，如果不支持dyld，则被当做SHARED对待。</p>
<p>EXCLUDE_FROM_ALL 意思是库不会被默认构建，除非有其他组件依赖或者手工构建</p>
<h3 id="5-3-添加一个静态库"><a href="#5-3-添加一个静态库" class="headerlink" title="5.3 添加一个静态库"></a>5.3 添加一个静态库</h3><p>修改lib 下的CMakeLists.txt来实现这个过程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># lib/CMakeLists.txt</span><br><span class="line">SET(LIBHELLO_SRC hello.c)</span><br><span class="line">ADD_LIBRARY(hello SHARED $&#123;LIBHELLO_SRC&#125;)</span><br><span class="line">ADD_LIBRARY(hello_static STATIC $&#123;LIBHELLO_SRC&#125;)</span><br><span class="line"># 先添加一个静态库，名字为hello_static</span><br><span class="line">SET_TARGET_PROPERTIES(hello_static PROPERTIES OUTPUT_NAME &quot;hello&quot;)</span><br><span class="line"># 为了得到同名的静态库和动态库，所以设置输出的名称</span><br><span class="line">SET_TARGET_PROPERTIES(hello PROPERTIES CLEAN_DIRECT_OUTPUT 1)</span><br><span class="line">SET_TARGET_PROPERTIES(hello_static PROPERTIES CLEAN_DIRECT_OUTPUT 1)</span><br><span class="line"># 为了避免删除已经存在的hello.so(生成新target会清除同名的文件)所以，定义了CLEAN_DIRECT_OUTPUT 属性。</span><br></pre></td></tr></table></figure></p>
<h3 id="5-4-动态库版本号"><a href="#5-4-动态库版本号" class="headerlink" title="5.4 动态库版本号"></a>5.4 动态库版本号</h3><p>按照规则，动态库是应该包含一个版本号的，我们可以看一下系统的动态库，一般情况是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libhello.so.1.2</span><br><span class="line">libhello.so -&gt;libhello.so.1</span><br><span class="line">libhello.so.1-&gt;libhello.so.1.2</span><br></pre></td></tr></table></figure></p>
<p>为了实现这一功能，所以我们修改了lib/CMakeList.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib/CMakeLists.txt</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(hello PROPERTIES VERSION <span class="number">1.2</span> SOVERSION <span class="number">1</span>)</span><br><span class="line"><span class="comment"># VERSION指代动态库版本</span></span><br><span class="line"><span class="comment"># SOVERSION指代API版本</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-5-安装共享库和头文件"><a href="#5-5-安装共享库和头文件" class="headerlink" title="5.5 安装共享库和头文件"></a>5.5 安装共享库和头文件</h3><p>为了把libhello.so.x和libhello.a,hello.h安装到系统目录让其他人开发使用，本例中将hello共享库安装到<code>&lt; prefix &gt;/lib</code>目录，将hello.h安装到<code>&lt; prefix &gt;/include/hello</code>目录。<br>利用INSTALL命令可以做到这一点。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># lib/CMakeLists.txt</span><br><span class="line">...</span><br><span class="line">INSTALL(TARGETS hello hello_static LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)</span><br><span class="line">INSTALL(FILES hello.h DESTINATION include/hello)</span><br></pre></td></tr></table></figure></p>
<p>然后bash执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr ..</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p>
<p>可将头文件和共享库安装到/usr下</p>
<h3 id="5-6-小结"><a href="#5-6-小结" class="headerlink" title="5.6 小结"></a>5.6 小结</h3><p>本小节，我们谈到了：<br>如何通过 ADD_LIBRARY 指令构建动态库和静态库。<br>如何通过 SET_TARGET_PROPERTIES 同时构建同名的动态库和静态库。<br>如何通过 SET_TARGET_PROPERTIES 控制动态库版本<br>最终使用上一节谈到的 INSTALL 指令来安装头文件和动态、静态库。</p>
<h2 id="6-如何使用外部共享库和头文件"><a href="#6-如何使用外部共享库和头文件" class="headerlink" title="6. 如何使用外部共享库和头文件"></a>6. 如何使用外部共享库和头文件</h2><h3 id="6-1-准备工作"><a href="#6-1-准备工作" class="headerlink" title="6.1 准备工作"></a>6.1 准备工作</h3><ol>
<li>建立t4目录，并在目录下建立src目录</li>
<li>进入src建一个main.c和CMakeLists.txt</li>
<li>在根目录建立工程的CMakeLists.txt</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/main.c */</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;hello.h&gt; //预处理头文件</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">        HelloFunc();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(main main.c)</span><br></pre></td></tr></table></figure>
<h3 id="6-2-外部构建"><a href="#6-2-外部构建" class="headerlink" title="6.2 外部构建"></a>6.2 外部构建</h3><ol>
<li>建立build目录</li>
<li>执行外部构建，发现make报错<blockquote>
<p>error: hello.h: 没有那个文件或目录。<br>因为hello.h位于/usr/include/hello 目录中，系统不能直接找到hello这个目录</p>
</blockquote>
</li>
</ol>
<h3 id="6-3-引入头文件的搜索位置"><a href="#6-3-引入头文件的搜索位置" class="headerlink" title="6.3 引入头文件的搜索位置"></a>6.3 引入头文件的搜索位置</h3><p>在<code>src/CMakeLists.txt</code>添加命令，引入头文件的搜索位置。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">INCLUDE_DIRECTORIES</span>(/usr/<span class="keyword">include</span>/hello)</span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(main main.c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># INCLUDE_DIRECTORIES([AFTER|BEFORE] [SYSTEM] 	dir1 dir2 ...)</span></span><br><span class="line"><span class="comment"># 默认的行为是追加到当前的头文件搜索路径的后面</span></span><br></pre></td></tr></table></figure></p>
<p>然后重新进行外部编译，结果出现不一样的报错。</p>
<blockquote>
<p> error:undefined reference to `HelloFunc’<br> 因为没有link到共享库libhello上</p>
</blockquote>
<h3 id="6-4-为-target-添加共享库"><a href="#6-4-为-target-添加共享库" class="headerlink" title="6.4 为 target 添加共享库"></a>6.4 为 target 添加共享库</h3><p>将目标文件链接到libhello,需要引入两个新指令。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加非标准的共享库搜索路径,这里不使用</span></span><br><span class="line"><span class="keyword">LINK_DIRECTORIES</span>(directory1 directory2 ...)</span><br><span class="line"><span class="comment"># 为target添加需要链接的共享库。</span></span><br><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(target library1 &lt;debug | optimized&gt; library2 ...)</span><br></pre></td></tr></table></figure></p>
<p>所以修改<code>src/CMakeLists.txt</code><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INCLUDE_DIRECTORIES</span>(/usr/<span class="keyword">include</span>/hello)</span><br><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(main main.c)</span><br><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(main hello)</span><br></pre></td></tr></table></figure></p>
<p>重新外部构建，正常运行。<br>可以使用ldd查看外部依赖。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ldd src/main</span><br><span class="line"> linux-gate.so.1 =&gt; (0xb7ee7000)</span><br><span class="line"> libhello.so.1 =&gt; /usr/lib/libhello.so.1 (0xb7ece000)</span><br><span class="line"> libc.so.6 =&gt; /lib/libc.so.6 (0xb7d77000)</span><br><span class="line"> /lib/ld-linux.so.2 (0xb7ee8000)</span><br></pre></td></tr></table></figure></p>
<p>如果链接到静态库也是一样，就是把hello改成libhello.a</p>
<h3 id="6-5-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH"><a href="#6-5-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH" class="headerlink" title="6.5 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH"></a>6.5 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</h3><p>这两个变量主要是用来解决以前 autotools 工程中–extra-include-dir 等参数的支持的。<br>也就是，如果头文件没有存放在常规路径(/usr/include, /usr/local/include 等)，则可以通过这些变量就行弥补。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">为了将程序更智能一点，我们可以使用 CMAKE_INCLUDE_PATH来进行，使用 bash 的方法</span><br><span class="line">如下：</span><br><span class="line">export CMAKE_INCLUDE_PATH=/usr/include/hello</span><br><span class="line">然后在头文件中将 INCLUDE_DIRECTORIES(/usr/include/hello)替换为：</span><br><span class="line">FIND_PATH(myHeader hello.h)</span><br><span class="line">IF(myHeader)</span><br><span class="line">INCLUDE_DIRECTORIES($&#123;myHeader&#125;)</span><br><span class="line">ENDIF(myHeader)</span><br><span class="line"></span><br><span class="line">如果你不使用 FIND_PATH，CMAKE_INCLUDE_PATH 变量的设置是没有作用的，你不能指望它会直接为编译器命令添加参数-I&lt;CMAKE_INCLUDE_PATH&gt;。</span><br><span class="line">以此为例，CMAKE_LIBRARY_PATH 可以用在 FIND_LIBRARY中。</span><br></pre></td></tr></table></figure></p>
<h3 id="6-6-小节"><a href="#6-6-小节" class="headerlink" title="6.6 小节"></a>6.6 小节</h3><p>本节我们探讨了:<br>如何通过 INCLUDE_DIRECTORIES 指令加入非标准的头文件搜索路径。<br>如何通过 LINK_DIRECTORIES 指令加入非标准的库文件搜索路径。<br>如果通过 TARGET_LINK_LIBRARIES 为库或可执行二进制加入库链接。<br>并解释了如何链接到静态库。</p>
<h2 id="7-cmake常用变量和常用环境变量"><a href="#7-cmake常用变量和常用环境变量" class="headerlink" title="7. cmake常用变量和常用环境变量"></a>7. cmake常用变量和常用环境变量</h2><h3 id="7-1-变量定义和引用"><a href="#7-1-变量定义和引用" class="headerlink" title="7.1 变量定义和引用"></a>7.1 变量定义和引用</h3><p><strong>显式定义：</strong><br>SET(VARIABLE_NAME file)<br><strong>隐式定义：</strong><br>比如PROJECT会隐式定义<code>&lt; projectname &gt;_BINARY_DIR</code>和<code>&lt; projectname &gt;_SOURCE_DIR</code> 两个变量。<br><strong>变量引用</strong><br>使用${}俩引用变量，而在IF等语句中直接使用变量名。</p>
<h3 id="7-2-CMake常用变量"><a href="#7-2-CMake常用变量" class="headerlink" title="7.2 CMake常用变量"></a>7.2 CMake常用变量</h3><ol>
<li><code>CMAKE_BINARY_DIR | PROJECT_BINARY_DIR|&lt; projectname &gt;_BINARY_DIR</code><br>三个变量指代同样的内容，如果是内部构建，就是工程的根目录。如果是外部构建，指的是编译发生的目录。</li>
<li><code>CMAKE_SOURCE_DIR|PROJECT_SOURCE_DIR|&lt;projectname&gt;_SOURCE_DIR</code><br>这三个变量指代的内容是一致的，不论哪一种构建方式，都是工程的根目录。</li>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code><br>当前处理的CMakeLists.txt所在的路径，比如上面提到的src子目录。</li>
<li><code>CMAKE_CURRENT_BINARY_DIR</code><br>如果是内部构建，它跟<code>CMAKE_CURRENT_SOURCE_DIR</code> 一致，如果是外部构建，他指的是 target 编译目录。<br>使用我们上面提到的 <code>ADD_SUBDIRECTORY(src bin)</code>可以更改这个变量的值。</li>
<li><code>CMAKE_CURRENT_LIST_FILE</code><br>输出调用这个变量的 CMakeLists.txt 的完整路径</li>
<li><code>CMAKE_CURRENT_LIST_LINE</code><br>输出这个变量所在的行</li>
<li><code>CMAKE_MODULE_PATH</code><br>这个变量用来定义自己的 cmake 模块所在的路径。如果你的工程比较复杂，有可能会自己编写一些 cmake 模块，这些 cmake 模块是随你的工程发布的，为了让 cmake 在处理<br>CMakeLists.txt 时找到这些模块，你需要通过 SET 指令，将自己的 cmake 模块路径设置一下。<br>比如<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(CMAKE_MODULE_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/cmake)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这时候可以通过 INCLUDE 指令来调用自己的模块了。</p>
<ol start="8">
<li><code>EXECUTABLE_OUTPUT_PATH</code> 和 <code>LIBRARY_OUTPUT_PATH</code><br>分别用来重新定义最终结果的存放目录</li>
<li><code>PROJECT_NAME</code><br>返回通过 PROJECT 指令定义的项目名称。<h3 id="7-3-CMake调用环境变量的方式"><a href="#7-3-CMake调用环境变量的方式" class="headerlink" title="7.3 CMake调用环境变量的方式"></a>7.3 CMake调用环境变量的方式</h3></li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ENV&#123;NAME&#125;</span><br><span class="line"><span class="comment"># 这个指令调用环境变量</span></span><br><span class="line"><span class="comment"># 比如</span></span><br><span class="line"><span class="keyword">MESSAGE</span>(STATUS <span class="string">"HOME dir : $ENV&#123;HOME&#125;"</span>)</span><br><span class="line"><span class="comment"># 设置环境变量的方式</span></span><br><span class="line"><span class="keyword">SET</span>(ENV&#123;NAME&#125; value)</span><br><span class="line"></span><br><span class="line">CMAKE_INCLUDE_CURRENT_DIR</span><br><span class="line"><span class="comment"># 自动添加 CMAKE_CURRENT_BINARY_DIR 和CMAKE_CURRENT_SOURCE_DIR 到当前处理的 CMakeLists.txt。</span></span><br><span class="line"></span><br><span class="line">CMAKE_INCLUDE_DIRECTORIES_PROJECT_BEFORE</span><br><span class="line"><span class="comment"># 将工程提供的头文件目录始终至于系统头文件目录的前面</span></span><br><span class="line"></span><br><span class="line">CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</span><br></pre></td></tr></table></figure>
<h3 id="7-4-系统信息的变量"><a href="#7-4-系统信息的变量" class="headerlink" title="7.4 系统信息的变量"></a>7.4 系统信息的变量</h3><ol>
<li>CMAKE_MAJOR_VERSION，CMAKE 主版本号，比如 2.4.6 中的 2</li>
<li>CMAKE_MINOR_VERSION，CMAKE 次版本号，比如 2.4.6 中的 4</li>
<li>CMAKE_PATCH_VERSION，CMAKE 补丁等级，比如 2.4.6 中的 6</li>
<li>CMAKE_SYSTEM，系统名称，比如 Linux-2.6.22</li>
<li>CMAKE_SYSTEM_NAME，不包含版本的系统名，比如 Linux</li>
<li>CMAKE_SYSTEM_VERSION，系统版本，比如 2.6.22</li>
<li>CMAKE_SYSTEM_PROCESSOR，处理器名称，比如 i686.</li>
<li>UNIX，在所有的类 UNIX 平台为 TRUE，包括 OS X 和 cygwin</li>
<li>WIN32，在所有的 win32 平台为 TRUE，包括 cygwin<h3 id="7-5-主要的开关选项"><a href="#7-5-主要的开关选项" class="headerlink" title="7.5 主要的开关选项"></a>7.5 主要的开关选项</h3></li>
<li><code>CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS</code><br>用来控制IF ELSE语句的书写方式，语法部分会讲到</li>
<li><code>BUILD_SHARED_LIBS</code><br>用来控制默认的库编译方式，如果不设置，使用<code>ADD_LIBRARY</code>并没有指定库类型的情况下，默认编译生成的都是静态库。<br>如果<code>SET(BUILD_SHARED_LIBS ON)</code>后，默认生成的是动态库。</li>
<li><code>CMAKE_C_FLAGS</code><br>设置C编译选项，也可以通过指令<code>ADD_DEFINITIONS()</code>添加</li>
<li><code>CMAKE_CXX_FLAGS</code><br>设置C++编译选项，也可以通过指令<code>ADD_DEFINITIONS()</code>添加<h3 id="7-6-小结"><a href="#7-6-小结" class="headerlink" title="7.6 小结"></a>7.6 小结</h3>本章介绍了一些较常用的 cmake 变量，这些变量仅仅是所有 cmake 变量的很少一部分。</li>
</ol>
<h2 id="8-CMake常用命令"><a href="#8-CMake常用命令" class="headerlink" title="8. CMake常用命令"></a>8. CMake常用命令</h2><h3 id="8-1-基本指令"><a href="#8-1-基本指令" class="headerlink" title="8.1 基本指令"></a>8.1 基本指令</h3><ol>
<li><code>ADD_DEFINITATIONS</code><br>向C/C++编译器添加-D定义，比如<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD_DEFINITATIONS(-DENABLE_DEBUG -DABC)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果代码中定义了<code>#ifdef #endif</code>代码块，那么会生效。</p>
<ol start="2">
<li><code>ADD_DEPENDENCIES</code><br>定义target依赖的其他target，确保在这个target编译前，其他target已经被构建。<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD_DEPENDENCIES</span>(target-name depend-target1)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="8-4-控制指令"><a href="#8-4-控制指令" class="headerlink" title="8.4 控制指令"></a>8.4 控制指令</h3><ol>
<li><p>IF指令</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">IF</span>(expression)</span><br><span class="line">	<span class="comment">#THEN section</span></span><br><span class="line">	COMMAND1(ARGS ...)</span><br><span class="line">	COMMAND2(ARGS ...)</span><br><span class="line"><span class="keyword">ELSE</span>(expression)</span><br><span class="line">	COMMAND1(ARGS...)</span><br><span class="line">	COMMAND2(ARGS...)</span><br><span class="line"><span class="keyword">ENDIF</span>(expression)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表达式使用方法</span></span><br><span class="line"><span class="keyword">IF</span>(var)</span><br><span class="line"><span class="comment"># 如果变量不是：空，0，N, NO, OFF, FALSE, NOTFOUND 或 &lt;var&gt;_NOTFOUND为真 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span>(NOT var)</span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span>(var1 <span class="keyword">AND</span> var2)</span><br><span class="line"><span class="comment"># 当两个变量都为真是为真。</span></span><br><span class="line"><span class="keyword">IF</span>(var1 <span class="keyword">OR</span> var2)</span><br><span class="line"><span class="comment"># 当两个变量其中一个为真时为真。</span></span><br><span class="line"><span class="keyword">IF</span>(COMMAND cmd)</span><br><span class="line"><span class="comment"># 当给定的 cmd 确实是命令并可以调用是为真。</span></span><br><span class="line"><span class="keyword">IF</span>(EXISTS dir)或者 <span class="keyword">IF</span>(EXISTS file)</span><br><span class="line"><span class="comment"># 当目录名或者文件名存在时为真。</span></span><br><span class="line"><span class="keyword">IF</span>(file1 IS_NEWER_THAN file2)</span><br><span class="line"><span class="comment"># 当 file1 比 file2 新，或者 file1/file2 其中有一个不存在时为真，文件名请使用完整路径。</span></span><br><span class="line"><span class="keyword">IF</span>(IS_DIRECTORY dirname)</span><br><span class="line"><span class="comment"># 当 dirname 是目录时，为真。</span></span><br><span class="line"><span class="keyword">IF</span>(variable <span class="keyword">MATCHES</span> regex)</span><br><span class="line"><span class="comment"># 当给定的变量或者字符串能够匹配正则表达式 regex 时为真。</span></span><br><span class="line"><span class="keyword">IF</span>(variable <span class="keyword">LESS</span>|<span class="keyword">GREATER</span>|<span class="keyword">EQUAL</span> number)</span><br><span class="line"><span class="comment"># 数字比较</span></span><br><span class="line"><span class="keyword">IF</span>(<span class="keyword">string</span> <span class="keyword">STRLESS</span>|<span class="keyword">STRGREATER</span>|<span class="keyword">STREQUAL</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="comment"># 字典序比较</span></span><br><span class="line"><span class="keyword">IF</span>(DEFINED variable)</span><br><span class="line"><span class="comment"># 如果被定义为真</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>while<br>WHILE 指令的语法是：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHILE</span>(condition)</span><br><span class="line"> COMMAND1(ARGS ...)</span><br><span class="line"> COMMAND2(ARGS ...)</span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">ENDWHILE</span>(condition)</span><br></pre></td></tr></table></figure>
</li>
<li><p>FOREACH<br>FOREACH 指令的使用方法有三种形式：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="keyword">FOREACH</span>(loop_var arg1 arg2 ...)</span><br><span class="line"> COMMAND1(ARGS ...)</span><br><span class="line"> COMMAND2(ARGS ...)</span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">ENDFOREACH</span>(loop_var)</span><br><span class="line"><span class="comment"># 范围</span></span><br><span class="line"><span class="keyword">FOREACH</span>(loop_var RANGE total)</span><br><span class="line"><span class="keyword">ENDFOREACH</span>(loop_var)</span><br><span class="line"><span class="comment"># 从 0 到 total 以１为步进</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围和步进</span></span><br><span class="line"><span class="keyword">FOREACH</span>(loop_var RANGE start stop [step])</span><br><span class="line"><span class="keyword">ENDFOREACH</span>(loop_var)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个指令需要注意的是，直到遇到 ENDFOREACH 指令，整个语句块才会得到真正的执行。</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="8-5-小结"><a href="#8-5-小结" class="headerlink" title="8.5 小结"></a>8.5 小结</h3><p>本小节基本涵盖了常用的 cmake 指令，包括基本指令、查找指令、安装指令以及控制语句等，特别需要注意的是，在控制语句条件中使用变量，不能用${}引用，而是直接应用变量名。</p>
<h3 id="10-参考"><a href="#10-参考" class="headerlink" title="10.参考"></a>10.参考</h3><p>《Cmake 实践》</p>
</div><div class="tags"></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2019/04/10/Shell编程/" class="pre">Shell编程</a><a href="/2019/03/01/性能分析工具（三）——valgrind/" class="next">性能分析工具（三）——valgrind</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CMAKE-学习"><span class="toc-text">CMAKE 学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-初始cmake"><span class="toc-text">1. 初始cmake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-特点"><span class="toc-text">1.1 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-问题"><span class="toc-text">1.2 问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-适用"><span class="toc-text">1.3 适用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-安装"><span class="toc-text">2. 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-初试cmake"><span class="toc-text">3. 初试cmake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-写一个简单的main-c和CMakeLists-txt"><span class="toc-text">3.1 写一个简单的main.c和CMakeLists.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-开始构建"><span class="toc-text">3.2 开始构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-简单解释"><span class="toc-text">3.3 简单解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-基本语法"><span class="toc-text">3.4 基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-关于语法的疑惑"><span class="toc-text">3.5 关于语法的疑惑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-清理工程"><span class="toc-text">3.6 清理工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-其他问题"><span class="toc-text">3.7 其他问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-内部构建与外部构建"><span class="toc-text">3.8 内部构建与外部构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-小结"><span class="toc-text">3.9 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-一个更好的helloworld"><span class="toc-text">4. 一个更好的helloworld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-准备工作"><span class="toc-text">4.1 准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-语法解释"><span class="toc-text">4.2 语法解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-另存为bin文件"><span class="toc-text">4.3 另存为bin文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-如何安装"><span class="toc-text">4.4 如何安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-修改Project并支持安装。"><span class="toc-text">4.5 修改Project并支持安装。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-小结"><span class="toc-text">4.6 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-静态库和动态库的构建"><span class="toc-text">5. 静态库和动态库的构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-建立并搭建一个动态库"><span class="toc-text">5.1 建立并搭建一个动态库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-语法解释"><span class="toc-text">5.2 语法解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-添加一个静态库"><span class="toc-text">5.3 添加一个静态库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-动态库版本号"><span class="toc-text">5.4 动态库版本号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-安装共享库和头文件"><span class="toc-text">5.5 安装共享库和头文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-小结"><span class="toc-text">5.6 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-如何使用外部共享库和头文件"><span class="toc-text">6. 如何使用外部共享库和头文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-准备工作"><span class="toc-text">6.1 准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-外部构建"><span class="toc-text">6.2 外部构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-引入头文件的搜索位置"><span class="toc-text">6.3 引入头文件的搜索位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-为-target-添加共享库"><span class="toc-text">6.4 为 target 添加共享库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH"><span class="toc-text">6.5 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-小节"><span class="toc-text">6.6 小节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-cmake常用变量和常用环境变量"><span class="toc-text">7. cmake常用变量和常用环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-变量定义和引用"><span class="toc-text">7.1 变量定义和引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-CMake常用变量"><span class="toc-text">7.2 CMake常用变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-CMake调用环境变量的方式"><span class="toc-text">7.3 CMake调用环境变量的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-系统信息的变量"><span class="toc-text">7.4 系统信息的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-主要的开关选项"><span class="toc-text">7.5 主要的开关选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-小结"><span class="toc-text">7.6 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-CMake常用命令"><span class="toc-text">8. CMake常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-基本指令"><span class="toc-text">8.1 基本指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-控制指令"><span class="toc-text">8.4 控制指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-小结"><span class="toc-text">8.5 小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-参考"><span class="toc-text">10.参考</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/13/剑指offer刷题笔记（一）/">剑指offer刷题笔记（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/13/Socket编程/">Socket编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/13/Effective C++ Note/">Effective C++ Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/13/Aurora Multi-Master 解读/">Aurora Multi-Master 解读</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/10/Make学习/">Make学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/10/Shell编程/">Shell编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/10/CMAKE 学习/">CMAKE 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/性能分析工具（三）——valgrind/">性能分析工具（三）——valgrind</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/性能分析工具（二）——perf/">性能分析工具（二）——perf</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/MysqlTuner使用/MysqlTuner使用/">MysqlTuner使用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cpp/">CPP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">Database</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/oj/">OJ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/性能分析/">性能分析</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Stockdean Mu.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>